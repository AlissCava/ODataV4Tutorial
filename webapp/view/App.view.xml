<mvc:View
    controllerName="sap.ui.core.tutorial.odatav4.controller.App"
    displayBlock="true"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc">
    <Shell>
        <App busy="{appView>/busy}" class="sapUiSizeCompact">
            <pages>
                <Page title="{i18n>peoplePageTitle}">
                  <headerContent>
                    <Button
                      id="resetChangesButton"
                      text="{i18n>resetChangesButtonText}"
                      enabled="{= !${appView>/hasUIChanges}}"
                      press="onResetDataSource"
                      type="Emphasized">
                    </Button>
                  </headerContent>
                    <content>
                        <Table
                            id="peopleList"
                            growing="true"
                            growingThreshold="10"
                            items="{
                                path: '/People',
                                parameters: {
                                $count: true,
                                    $$updateGroupId : 'peopleGroup'
                                }
                            }"
                            mode="SingleSelectLeft">
                            <headerToolbar>
                                <OverflowToolbar>
                                    <content>
                                        <ToolbarSpacer/>
                                        <SearchField
                                            id="searchField"
                                            width="20%"
                                            placeholder="{i18n>searchFieldPlaceholder}"
                                            enabled="{= !${appView>/hasUIChanges}}"
                                            search=".onSearch"/>
                                        <Button
                                            id="addUserButton"
                                            icon="sap-icon://add"
                                            tooltip="{i18n>createButtonText}"
                                            press=".onCreate">
                                            <layoutData>
                                                <OverflowToolbarLayoutData priority="NeverOverflow"/>
                                            </layoutData>
                                        </Button>

                                        <Button
                                          id="deleteUserButton"
                                          icon="sap-icon://delete"
                                          tooltip="{i18n>deleteButtonText}"
                                          press=".onDelete">
                                          <layoutData>
                                            <OverflowToolbarLayoutData priority="NeverOverflow"/>
                                          </layoutData>
                                        </Button>

                                        <Button
                                            id="refreshUsersButton"
                                            icon="sap-icon://refresh"
                                            enabled="{= !${appView>/hasUIChanges}}"
                                            tooltip="{i18n>refreshButtonText}"
                                            press=".onRefresh"/>
                                        <Button
                                            id="sortUsersButton"
                                            icon="sap-icon://sort"
                                            enabled="{= !${appView>/hasUIChanges}}"
                                            tooltip="{i18n>sortButtonText}"
                                            press=".onSort"/>
                                    </content>
                                </OverflowToolbar>
                            </headerToolbar>
                            <columns>
                                <Column id="userNameColumn">
                                    <Text text="{i18n>userNameLabelText}"/>
                                </Column>
                                <Column id="firstNameColumn">
                                    <Text text="{i18n>firstNameLabelText}"/>
                                </Column>
                                <Column id="lastNameColumn">
                                    <Text text="{i18n>lastNameLabelText}"/>
                                </Column>
                                <Column id="ageColumn">
                                    <Text text="{i18n>ageLabelText}"/>
                                </Column>
                            </columns>
                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <Input
                                            value="{UserName}"
                                            valueLiveUpdate="true"
                                            liveChange=".onInputChange"/>

                                    </cells>
                                    <cells>
                                        <Input
                                            value="{FirstName}"
                                            liveChange=".onInputChange"/>
                                    </cells>
                                    <cells>
                                        <Input
                                            value="{LastName}"
                                            liveChange=".onInputChange"/>
                                    </cells>
                                    <cells>
                                        <Input
                                            value="{Age}"
                                            valueLiveUpdate="true"
                                            liveChange=".onInputChange"/>
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </content>
                    <footer>
                        <Toolbar visible="{appView>/hasUIChanges}">
                            <ToolbarSpacer/>
                            <Button
                                id="saveButton"
                                type="Emphasized"
                                text="{i18n>saveButtonText}"
                                enabled="{= ${message>/}.length === 0 &amp;&amp; ${appView>/usernameEmpty} === false }"
                                press=".onSave"/>
                            <Button
                                id="doneButton"
                                text="{i18n>cancelButtonText}"
                                press=".onResetChanges"/>
                        </Toolbar>
                    </footer>

                </Page>
            </pages>
        </App>
    </Shell>
</mvc:View>



<!--
Step 3
* Inseriamo una 'headerToolbar' all'interno della tabella con un singolo pulsante (Button).
* Il pulsante è configurato con un evento 'press' a cui colleghiamo il gestore eventi 'onRefresh'
* definito nel controller, permettendo all'utente di sincronizzare manualmente i dati con il server.
-->

<!--
Step 5
Abbiamo aggiunto il parametro 
* '$count: true' al binding per ricevere dal service
* il numero totale di entità, visualizzabile sotto il pulsante 'More'. 
* Nella 'OverflowToolbar' sono stati inseriti un campo di ricerca (SearchField) e un pulsante di ordinamento (Sort Button), collegandoli ai rispettivi 
* gestori eventi nel controller.
-->

<!--
Step 6
* - Spostate le azioni di salvataggio nella footer toolbar, visibile solo in caso di modifiche. 
* - Implementata la validazione live sui campi Input tramite 'liveChange'.
* - Rafforzata la logica del pulsante Save: abilitato solo se lo UserName è presente e non vi sono errori tecnici nel MessageModel.
* - Disabilitate le azioni di navigazione (Search, Sort, Refresh) durante l'editing per garantire l'integrità dei dati pendenti.-->

<!--
Step 7
* - Aggiunto il metodo 'onDelete' per gestire la rimozione dei record selezionati.
* - La tabella è stata impostata in modalità 'SingleSelectLeft' per permettere 
* l'identificazione univoca del contesto (Binding Context) da eliminare.
* - L'operazione di cancellazione invoca il metodo .delete() direttamente sul 
* contesto selezionato, sincronizzandosi automaticamente con il backend.
-->